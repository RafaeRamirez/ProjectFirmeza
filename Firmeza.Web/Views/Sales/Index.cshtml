@model IEnumerable<Firmeza.Web.Models.Sale>
@{ ViewData["Title"]="Ventas"; }
@{
    string fromValue = ViewBag.FilterFrom as string ?? "";
    string toValue = ViewBag.FilterTo as string ?? "";
    string filterCustomer = ViewBag.FilterCustomerId as string ?? "";
    string minValue = ViewBag.FilterMinTotal as string ?? "";
    string maxValue = ViewBag.FilterMaxTotal as string ?? "";
    var customers = (ViewBag.Customers as IEnumerable<Firmeza.Web.Models.Customer>) ?? Enumerable.Empty<Firmeza.Web.Models.Customer>();
}
<div class="d-flex justify-content-between align-items-center mb-3">
    <h2>Ventas</h2>
    <div class="d-flex gap-2">
        <a class="btn btn-outline-primary"
           asp-action="Export"
           asp-route-from="@fromValue"
           asp-route-to="@toValue"
           asp-route-customerId="@filterCustomer"
           asp-route-minTotal="@minValue"
           asp-route-maxTotal="@maxValue">Exportar Excel</a>
        <a class="btn btn-success" asp-action="Create">Registrar venta</a>
    </div>
</div>

<form method="get" class="card card-body mb-3">
    <div class="row g-3 align-items-end">
        <div class="col-md-3">
            <label class="form-label">Desde</label>
            <input type="date" name="from" class="form-control" value="@fromValue" />
        </div>
        <div class="col-md-3">
            <label class="form-label">Hasta</label>
            <input type="date" name="to" class="form-control" value="@toValue" />
        </div>
        <div class="col-md-3">
            <label class="form-label">Cliente</label>
            <select name="customerId" class="form-select">
                <option value="">Todos</option>
                @foreach (var c in customers)
                {
                    <option value="@c.Id" selected="@(filterCustomer == c.Id.ToString() ? "selected" : null)">@c.FullName</option>
                }
            </select>
        </div>
        <div class="col-md-1">
            <label class="form-label">Mín.</label>
            <input type="number" name="minTotal" class="form-control" step="0.01" value="@minValue" />
        </div>
        <div class="col-md-1">
            <label class="form-label">Máx.</label>
            <input type="number" name="maxTotal" class="form-control" step="0.01" value="@maxValue" />
        </div>
        <div class="col-md-1 d-flex gap-2">
            <button class="btn btn-primary w-100" type="submit">Filtrar</button>
        </div>
        <div class="col-md-1">
            <a class="btn btn-outline-secondary w-100" asp-action="Index">Limpiar</a>
        </div>
    </div>
</form>
<table class="table table-striped"><thead><tr><th>Fecha</th><th>Cliente</th><th>Total</th><th class="text-end">Acciones</th></tr></thead><tbody>
@foreach(var s in Model){
    <tr>
        <td>@s.CreatedAt.ToLocalTime().ToString("yyyy-MM-dd HH:mm")</td>
        <td>@s.Customer?.FullName</td>
        <td>@s.Total.ToString("0.00")</td>
        <td class="text-end">
            <a class="btn btn-sm btn-outline-primary" asp-action="Details" asp-route-id="@s.Id">Ver</a>
            <a class="btn btn-sm btn-outline-secondary" asp-action="Edit" asp-route-id="@s.Id">Editar</a>
            <a class="btn btn-sm btn-outline-danger" asp-action="Delete" asp-route-id="@s.Id">Eliminar</a>
        </td>
    </tr>
} </tbody></table>
